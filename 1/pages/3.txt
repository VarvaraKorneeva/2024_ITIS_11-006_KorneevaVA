елеграм бот на пишем с нуля на примере бота с курсом валют Основы Уроки Примеры Библиотеки База знаний Поиск Основы Уроки Примеры Библиотеки База знаний Главная Примеры Как создать чат бота для с помощью Как создать чат бота для с помощью Это пошаговое руководство по созданию бота для Бот будет показывать курсы валют разницу между курсом раньше и сейчас а также использовать современные встроенные клавиатуры Время переходить к делу и узнать наконец как создавать ботов в Шаг немного теории об ботов Начать руководство стоит с простого вопроса как создавать чат ботов в Ответ очень простой для чтения сообщений отправленных пользователями и для отправки сообщений назад используется Это требует использования Токен уникальная строка из символов которая нужна для того чтобы установить подлинность бота в системе Токен генерируется при создании бота это метод например и так далее Токен выглядит приблизительно так Для выполнения запросов используются как так и запросы Многие методы требуют дополнительных параметров методу например нужно передать и текст Эти параметры могут быть переданы как строка запроса и кроме загрузки файлов Еще одно требование кодировка После отправки запроса к вы получаете ответ в формате Например если извлечь данные с помощью метода ответ будет такой Если значение значит запрос был успешным и результат отобразится в поле Если в поле будет сообщение об ошибке Список всех типов данных и методов бота можно найти здесь или с переводом здесь ру Следующий вопрос как получать пользовательские сообщения Есть два варианта Первый вручную создавать запросы с помощью метода В качестве объекта вы получите массив объектов Этот метод работает как технология длинных опросов когда вы отправляете запрос обрабатываете данные и начинаете повторяете процесс Чтобы избежать повторной обработки одних и тех же данных рекомендуется использовать параметр Второй вариант использовать Метод нужно будет применить только один раз После этого будет отправлять все обновления на конкретный адрес как только они появятся Единственное ограничение необходим но можно использовать и сертификаты заверенные самостоятельно Как выбрать оптимальный метод Метод лучше всего подходит если Вы не хотите или не можете настраивать во время разработки Вы работаете со скриптовыми языками которые сложно интегрировать в веб сервер У бота высокая нагрузка Вы меняете сервер бота время от времени Метод с лучше подойдет в таких случаях Вы используете веб языки например У бота низкая нагрузка и нет смысла делать запросы вручную Бот на постоянной основе интегрирован в веб сервер В этом руководстве будет использоваться метод Еще один вопрос как создать зарегистрировать бота используется для создания ботов в Он также отвечает за базовую настройку описание фото профиля встроенная поддержка и так далее Существует масса библиотек которые облегчают процесс работы с бота Вот некоторые из них По своей сути все эти библиотеки оболочки запросов Большая часть из них написана с помощью принципов ООП Типы данных представлены в виде классов В этом руководстве будет использоваться библиотека Шаг реализовать запросы курсов валют Весь код был проверен на версии использование библиотек Полезно Краткое руководство по библиотеке Начать стоит с написания скрипта который будет реализовывать логику конкретных запросов курсов валют Использовать будем Пример ответа Создадим файл со следующим кодом Были реализованы три метода загружает курсы валют по указанному адресу и возвращает их в формате словаря возвращает курсы валют по запрошенной валюте возвращает список валют в соответствии с шаблоном требуется для поиска валют во встроенных запросах Шаг создать бота с помощью Необходимо подключиться к боту чтобы получить список чат команд в Далее нужно набрать команду для инструкций выбора название и имени бота После успешного создания бота вы получите следующее сообщение Его нужно сразу настроить Необходимо добавить описание и текст о боте команды и фото профиля включить встроенный режим добавить описания команд Потребуется использовать две команды и Стоит описать их в Теперь когда настройка закончена можно переходить к написанию кода Прежде чем двигаться дальше рекомендуется почитать об и ознакомиться с документацией библиотеки чтобы лучше понимать то о чем пойдет речь дальше Шаг настроить и запустить бота Начнем с создания файла для настройки заменить на токен своего бота В этом файле указаны токен бота и часовой пояс в котором тот будет работать это понадобится в будущем для определения времени обновления сообщений не позволяет видеть временную зону пользователя поэтому время обновления должно отображаться с подсказкой о часовом поясе Создадим файл Нужно импортировать все необходимые библиотеки файлы с настройками и предварительно созданный Если каких то библиотек не хватает их можно установить с помощью Создадим бота с помощью библиотеки Для этого конструктору нужно передать токен Шаг написать обработчик команды Теперь чат бот на работает и постоянно посылает запросы с помощью метода Параметр отвечает за то чтобы запросы отправлялись даже если возвращает ошибку при выполнении метода Из переменной бота возможно вызывать любые методы бота Начнем с написания обработчика команды и добавим его перед строкой Как можно видеть использует декораторы для запуска обработчиков разных команд Также можно перехватывать сообщения с помощью регулярных выражений узнавать тип содержимого в них и лямбда функции В нашем случае если условие равно тогда будет вызвана функция Объект сообщения десериализованный тип будет передан функции После этого вы просто запускаете в том же чате с конкретным сообщением Это было просто не так ли Шаг создать обработчик команды Давайте оживим обработчик команды с помощью встроенной кнопки со ссылкой на ваш аккаунт в Кнопку можно озаглавить Как видно в примере выше был использован дополнительный параметр для метода Метод получил встроенную клавиатуру с одной кнопкой и следующим текстом и Код выше выглядит вот так Шаг добавить обработчик команды Обработчик команды отображает меню выбора валюты и встроенную клавиатуру с кнопками и это валюты поддерживаемые банка Вот как работает Когда пользователь нажимает на кнопку вы получаете в параметре содержится в Таким образом вы знаете какую именно кнопку нажал пользователь и как ее правильно обработать Вот как работает ответ Шаг написать обработчик для кнопок встроенной клавиатуры В библиотеке есть декоратор который передает объект во вложенную функцию Давайте реализуем метод Метод нужен чтобы убрать состояние загрузки к которому переходит бот после нажатия кнопки Отправим сообщение Ему нужно передать и код валюты получить ее можно из Если это например передавайте Реализуем Все довольно просто Сперва отправим состояние ввода в чат так чтобы бот показывал индикатор набора текста пока банка получает запрос Теперь вызовем метод из файла который получит код валюты например Также нужно вызвать два новых метода в сериализатор валюты и который возвращает клавиатуре кнопки и Запишем в текущий курс валют в в форме сжимается потому что максимальный разрешенный размер файла равен байтам Кнопка значит тип а обмен Остальное выполнено по тому же принципу У кнопки есть параметр После нажатия кнопки пользователю будет предложено выбрать один из чатов открыть этот чат и ввести имя бота и определенный запрос в поле ввода Методы и дополнительный нужны чтобы показывать разницу между текущим и старыми курсами валют после нажатия кнопки Как видно метод получает необязательный параметр Ему будет передаваться разница между курсами обмена в формате Это будет происходить во время сериализации после нажатия кнопки Когда курсы валют отображаются первый раз он нам не нужен Вот как будет выглядеть бот после нажатия кнопки Шаг реализовать обработчик кнопки обновления Теперь можно создать обработчик кнопки После дополнения метода он будет выглядеть следующим образом Если данные обратного вызова начинаются с и так далее тогда нужно вызывать как раньше В противном случае стоит попробовать разобрать строку и получить ее ключ Если его значение равно тогда нужно вызвать метод Реализуем это Как это работает Очень просто Загружаем текущий курс валюты Генерируем текст нового сообщения путем сериализации текущего курса валют с параметром который можно получить с помощью новых методов о них дальше Также нужно добавить подпись Вызываем метод если оригинальное сообщение не изменилось Если это ответ на встроенный запрос передаем другие параметры Метод разбирает из Метод получает старое и текущее значение курсов валют и возвращает разницу в формате генерирует текст Вот как выглядит сообщение после обновления если курсы валют не изменились И вот так если изменились Шаг реализовать встроенный режим Реализация встроенного режима значит что если пользователь введет имя бота в любом чате это активирует поиск введенного текста и выведет результаты После нажатия на один из них бот отправит результат от вашего имени с пометкой Обработчик встроенных запросов реализован Библиотека передаст объект в функцию Внутри используется функция которая должна получить и массив объектов результаты поиска Используем для поиска нескольких валют подходящих под запрос Нужно передать этот массив методу который вернет массив из Теперь при вводе пробел вы увидите следующее Попробуем набрать и результат мгновенно отфильтруется Проверим предложенный результат Кнопка тоже работает Отличная работа Вы реализовали встроенный режим Выводы Поздравляем Теперь вы знаете как сделать бота для добавить встроенную клавиатуру обновление сообщений и встроенный режим Можете похлопать себя по спине и поднять тост за нового бота Источник ТЕГИ боты Максим Я создал этот блог в году чтобы распространять полезные учебные материалы документации и уроки на русском На сайте опубликовано множество статей по основам и библиотекам уроков для начинающих и примеров написания программ Мои контакты Почта Александр Редактор Статьи по теме Нахождение делителей числа с помощью Поиск максимального значения в списке на Количество элементов в списке с условиями или критериями как использовать в шаблонах Встроенные для машинного обучения Как настроить в Содержание Шаг немного теории об ботов Шаг реализовать запросы курсов валют Шаг создать бота с помощью Шаг настроить и запустить бота Шаг написать обработчик команды Шаг создать обработчик команды Шаг добавить обработчик команды Шаг написать обработчик для кнопок встроенной клавиатуры Шаг реализовать обработчик кнопки обновления Шаг реализовать встроенный режим Выводы Новое в блоге Нахождение делителей числа с помощью Лямбда функции и анонимные функции в Когда стоит использовать вместо в Как извлечь кубический корень в О проекте Политика конфиденциальности Правообладателям Контакты Хостинг Образовательный блог о 